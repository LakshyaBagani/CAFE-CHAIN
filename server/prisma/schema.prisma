generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

model user {
  name     String
  email    String  @unique
  password String
  number   BigInt  @unique
  isVerify Boolean @default(false)
  id       Int     @id @default(autoincrement())
  OTPCode  String?
  balance  Int     @default(0)
  orders   order[]
}

model userWallet {
  id            Int      @id @default(autoincrement())
  userId        Int
  amount        Int      @default(0)
  modeOfPayment String
  createdAt     DateTime @default(now())
}

model resto {
  id          Int     @id @default(autoincrement())
  name        String
  location    String
  number      String  @unique
  email       String  @unique
  password    String
  open        Boolean @default(true)
  menuVersion Int     @default(1)
  ads         ads[]
  menus       menu[]
  orders      order[]

  @@index([open])
  @@index([location])
}

model menu {
  id           Int         @id @default(autoincrement())
  name         String
  price        Int
  description  String
  imageUrl     String
  restoId      Int
  veg          Boolean
  category     String
  availability Boolean     @default(true)
  ads          ads[]
  resto        resto       @relation(fields: [restoId], references: [id])
  orderItems   orderItem[]

  @@index([restoId])
  @@index([availability])
  @@index([category])
  @@index([restoId, availability])
  @@index([restoId, category])
}

model orderItem {
  id       Int   @id @default(autoincrement())
  orderId  Int
  menuId   Int
  quantity Int
  menu     menu  @relation(fields: [menuId], references: [id])
  order    order @relation(fields: [orderId], references: [id])
}

model order {
  id            Int         @id @default(autoincrement())
  userId        Int
  totalPrice    Int
  status        String      @default("Pending")
  createdAt     DateTime    @default(now())
  paymentMethod String
  deliveryType  String
  restoId       Int
  resto         resto       @relation(fields: [restoId], references: [id])
  user          user        @relation(fields: [userId], references: [id])
  orderItems    orderItem[]

  @@index([restoId])
  @@index([status])
  @@index([createdAt])
  @@index([restoId, status])
  @@index([restoId, createdAt])
  @@index([status, createdAt])
  @@index([restoId, status, createdAt])
}

model ads {
  id       Int     @id @default(autoincrement())
  restoId  Int
  valid    Boolean @default(true)
  menuId   Int
  discount Int
  menu     menu    @relation(fields: [menuId], references: [id])
  resto    resto   @relation(fields: [restoId], references: [id])
}
